<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sensor (mindstorm.Mindstorm.NXT.Sensor)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">mindstorm</a> &#x00BB; <a href="../../index.html">Mindstorm</a> &#x00BB; <a href="../index.html">NXT</a> &#x00BB; Sensor</nav><h1>Module <code>NXT.Sensor</code></h1><p>Input ports.</p><p>The NXT brick also accepts the sensors for the previous version of the mindstorm brick, called RCX, so several options refer to RCX.</p><nav class="toc"><ul><li><a href="#low-speed">Low speed</a></li><li><a href="#convenience">Convenience</a></li></ul></nav></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dt class="spec type" id="type-port"><a href="#type-port" class="anchor"></a><code><span class="keyword">type</span> port</code> = <code>[ </code><table class="variant"><tr id="type-port.S1" class="anchored"><td class="def constructor"><a href="#type-port.S1" class="anchor"></a><code>| </code><code>`S1</code></td></tr><tr id="type-port.S2" class="anchored"><td class="def constructor"><a href="#type-port.S2" class="anchor"></a><code>| </code><code>`S2</code></td></tr><tr id="type-port.S3" class="anchored"><td class="def constructor"><a href="#type-port.S3" class="anchor"></a><code>| </code><code>`S3</code></td></tr><tr id="type-port.S4" class="anchored"><td class="def constructor"><a href="#type-port.S4" class="anchor"></a><code>| </code><code>`S4</code></td></tr></table><code> ]</code></dt><dd><p>The four sensor ports, labeled 1 to 4 on the brick. It is recommended you give meaningful names to values of type <code>port</code> through let bindings.</p></dd></dl><dl><dt class="spec type" id="type-sensor_type"><a href="#type-sensor_type" class="anchor"></a><code><span class="keyword">type</span> sensor_type</code> = <code>[ </code><table class="variant"><tr id="type-sensor_type.No_sensor" class="anchored"><td class="def constructor"><a href="#type-sensor_type.No_sensor" class="anchor"></a><code>| </code><code>`No_sensor</code></td></tr><tr id="type-sensor_type.Switch" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Switch" class="anchor"></a><code>| </code><code>`Switch</code></td></tr><tr id="type-sensor_type.Temperature" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Temperature" class="anchor"></a><code>| </code><code>`Temperature</code></td></tr><tr id="type-sensor_type.Reflection" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Reflection" class="anchor"></a><code>| </code><code>`Reflection</code></td></tr><tr id="type-sensor_type.Angle" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Angle" class="anchor"></a><code>| </code><code>`Angle</code></td></tr><tr id="type-sensor_type.Light_active" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Light_active" class="anchor"></a><code>| </code><code>`Light_active</code></td></tr><tr id="type-sensor_type.Light_inactive" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Light_inactive" class="anchor"></a><code>| </code><code>`Light_inactive</code></td></tr><tr id="type-sensor_type.Sound_db" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Sound_db" class="anchor"></a><code>| </code><code>`Sound_db</code></td></tr><tr id="type-sensor_type.Sound_dba" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Sound_dba" class="anchor"></a><code>| </code><code>`Sound_dba</code></td></tr><tr id="type-sensor_type.Custom" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Custom" class="anchor"></a><code>| </code><code>`Custom</code></td></tr><tr id="type-sensor_type.Lowspeed" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Lowspeed" class="anchor"></a><code>| </code><code>`Lowspeed</code></td></tr><tr id="type-sensor_type.Lowspeed_9v" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Lowspeed_9v" class="anchor"></a><code>| </code><code>`Lowspeed_9v</code></td></tr><tr id="type-sensor_type.Highspeed" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Highspeed" class="anchor"></a><code>| </code><code>`Highspeed</code></td></tr><tr id="type-sensor_type.Color_full" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Color_full" class="anchor"></a><code>| </code><code>`Color_full</code></td></tr><tr id="type-sensor_type.Color_red" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Color_red" class="anchor"></a><code>| </code><code>`Color_red</code></td></tr><tr id="type-sensor_type.Color_green" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Color_green" class="anchor"></a><code>| </code><code>`Color_green</code></td></tr><tr id="type-sensor_type.Color_blue" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Color_blue" class="anchor"></a><code>| </code><code>`Color_blue</code></td></tr><tr id="type-sensor_type.Color_none" class="anchored"><td class="def constructor"><a href="#type-sensor_type.Color_none" class="anchor"></a><code>| </code><code>`Color_none</code></td></tr></table><code> ]</code></dt><dd><p>Sensor type for a port. The sensor type primarily affects scaling factors used to calculate the normalized sensor value <code>`Raw</code>, but some values have other side effects.</p><ul><li><code>`No_sensor</code>: No sensor configured</li><li><code>`Switch</code>: NXT or RCX touch sensor</li><li><code>`Temperature</code>: RCX temperature sensor</li><li><code>`Reflection</code>: RCX light sensor</li><li><code>`Angle</code>: RCX rotation sensor</li><li><code>`Light_active</code>: NXT light sensor with floodlight enabled</li><li><code>`Light_inactive</code>: NXT light sensor with floodlight disabled</li><li><code>`Sound_db</code>: NXT sound sensor; includes sounds too high or too low for our ears.</li><li><code>`Sound_dba</code>: NXT sound sensor; focuses on sounds within human hearing.</li><li><code>`Custom</code></li><li><code>`Lowspeed</code>: I2C digital sensor</li><li><code>`Lowspeed_9v</code>: I2C digital sensor, 9V power (e.g. ultrasonic).</li><li><code>`Highspeed</code>: Set <code>`S4</code> to highspeed mode. This is currently unused by LEGO® sensors. This targets the P-Net communication protocol (www.P-net.org).</li></ul><p>The LEGO® NXT 2.0 (8547) includes a color sensor with a tri-color led. The following values allow to configure it. If you have an older brick, this may require that you update its firmware. To do it under Linux, you can issue the command <code>./fwflash path_to_firmware.rfw</code> (as root) where <code>fwflash</code> comes from <a href="http://code.google.com/p/libnxt/">libnxt</a>. The firmware 1.28 can be dowloaded from http://legoengineering.com/library/doc_details/250-nxt-firmware-v128.html</p><ul><li><code>Color_full</code> white floodlight (all 3 leds on).</li><li><code>Color_red</code> red floodlight.</li><li><code>Color_green</code> green floodlight.</li><li><code>Color_blue</code> blue floodlight.</li><li><code>Color_none</code> no floodlight (passive mode).</li></ul></dd></dl><dl><dt class="spec type" id="type-mode"><a href="#type-mode" class="anchor"></a><code><span class="keyword">type</span> mode</code> = <code>[ </code><table class="variant"><tr id="type-mode.Raw" class="anchored"><td class="def constructor"><a href="#type-mode.Raw" class="anchor"></a><code>| </code><code>`Raw</code></td></tr><tr id="type-mode.Bool" class="anchored"><td class="def constructor"><a href="#type-mode.Bool" class="anchor"></a><code>| </code><code>`Bool</code></td></tr><tr id="type-mode.Transition_cnt" class="anchored"><td class="def constructor"><a href="#type-mode.Transition_cnt" class="anchor"></a><code>| </code><code>`Transition_cnt</code></td></tr><tr id="type-mode.Period_counter" class="anchored"><td class="def constructor"><a href="#type-mode.Period_counter" class="anchor"></a><code>| </code><code>`Period_counter</code></td></tr><tr id="type-mode.Pct_full_scale" class="anchored"><td class="def constructor"><a href="#type-mode.Pct_full_scale" class="anchor"></a><code>| </code><code>`Pct_full_scale</code></td></tr><tr id="type-mode.Celsius" class="anchored"><td class="def constructor"><a href="#type-mode.Celsius" class="anchor"></a><code>| </code><code>`Celsius</code></td></tr><tr id="type-mode.Fahrenheit" class="anchored"><td class="def constructor"><a href="#type-mode.Fahrenheit" class="anchor"></a><code>| </code><code>`Fahrenheit</code></td></tr><tr id="type-mode.Angle_steps" class="anchored"><td class="def constructor"><a href="#type-mode.Angle_steps" class="anchor"></a><code>| </code><code>`Angle_steps</code></td></tr><tr id="type-mode.Slope_mask" class="anchored"><td class="def constructor"><a href="#type-mode.Slope_mask" class="anchor"></a><code>| </code><code>`Slope_mask</code></td></tr></table><code> ]</code></dt><dd><p>Sensor mode.</p><ul><li><code>`Raw</code>: Report scaled value equal to raw value.</li><li><code>`Bool</code>: Report scaled value as 1 (TRUE) or 0 (FALSE). Note that for the switch sensor, the value is 1 of the button is pressed at the moment the data is requested. Use <code>`Transition_cnt</code> if you want not to miss button presses between two requests. The firmware uses inverse Boolean logic to match the physical characteristics of NXT sensors. Readings are FALSE if raw value exceeds 55% of total range; readings are TRUE if raw value is less than 45% of total range.</li><li><code>`Transition_cnt</code>: Report scaled value as number of transitions between TRUE and FALSE. May not be fully exact if transitions are fast.</li><li><code>`Period_counter</code>: Report scaled value as number of transitions from FALSE to TRUE, then back to FALSE.</li><li><code>`Pct_full_scale</code>: Report scaled value as percentage of full scale reading for configured sensor type.</li><li><code>`Celsius</code>: Scale temperature reading to degrees Celsius.</li><li><code>`Fahrenheit</code>: Scale temperature reading to degrees Fahrenheit.</li><li><code>`Angle_steps</code>: Report scaled value as count of ticks on RCX-style rotation sensor.</li></ul></dd></dl><dl><dt class="spec value" id="val-set"><a href="#val-set" class="anchor"></a><code><span class="keyword">val</span> set : ?&#8288;check_status:bool <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../index.html#type-conn">conn</a> <span>&#45;&gt;</span> <a href="index.html#type-port">port</a> <span>&#45;&gt;</span> <a href="index.html#type-sensor_type">sensor_type</a> <span>&#45;&gt;</span> <a href="index.html#type-mode">mode</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set conn p ty m</code> set the sensor connected to port <code>p</code> to type <code>ty</code> and mode <code>m</code>.</p><dl><dt>parameter check_status</dt><dd><p>whether to check the status returned by the brick. Default: see <a href="../index.html#val-connect_bluetooth"><code>Mindstorm.NXT.connect_bluetooth</code></a>.</p></dd></dl></dd></dl><dl><dt class="spec type" id="type-data"><a href="#type-data" class="anchor"></a><code><span class="keyword">type</span> data</code><code> = </code><code>{</code><table class="record"><tr id="type-data.sensor_type" class="anchored"><td class="def field"><a href="#type-data.sensor_type" class="anchor"></a><code>sensor_type : <a href="index.html#type-sensor_type">sensor_type</a>;</code></td></tr><tr id="type-data.mode" class="anchored"><td class="def field"><a href="#type-data.mode" class="anchor"></a><code>mode : <a href="index.html#type-mode">mode</a>;</code></td></tr><tr id="type-data.valid" class="anchored"><td class="def field"><a href="#type-data.valid" class="anchor"></a><code>valid : bool;</code></td><td class="doc"><p><code>true</code> if new data value should be seen as valid</p></td></tr><tr id="type-data.raw" class="anchored"><td class="def field"><a href="#type-data.raw" class="anchor"></a><code>raw : int;</code></td><td class="doc"><p>Raw A/D value. Device dependent. Range: 0 .. 1023</p></td></tr><tr id="type-data.normalized" class="anchored"><td class="def field"><a href="#type-data.normalized" class="anchor"></a><code>normalized : int;</code></td><td class="doc"><p>Normalized A/D value. Range: 0 .. 1023</p></td></tr><tr id="type-data.scaled" class="anchored"><td class="def field"><a href="#type-data.scaled" class="anchor"></a><code>scaled : int;</code></td><td class="doc"><p>Scaled value. Its range depend on the <a href="index.html#type-mode"><code>Mindstorm.NXT.Sensor.mode</code></a> chosen:</p><ul><li><code>`Raw</code>: 0 .. 1023</li><li><code>`Boolean</code>: 0 or 1</li><li><code>`Transition_cnt</code>: 0 .. 65535</li><li><code>`Period_counter</code>: 0 .. 65535</li><li><code>`Pct_full_scale</code>: 0 .. 100</li><li><code>`Celsius</code>: -200 .. 700 (10th of degree Celsius)</li><li><code>`Fahrenheit</code>: -400 .. 1580 (10th of degree Fahrenheit)</li><li><code>`Angle_steps</code>: 0 .. 65535</li></ul></td></tr></table><code>}</code></dt><dd><p>Data read from sensors.</p></dd></dl><dl><dt class="spec value" id="val-get"><a href="#val-get" class="anchor"></a><code><span class="keyword">val</span> get : <span class="type-var">'a</span> <a href="../index.html#type-conn">conn</a> <span>&#45;&gt;</span> <a href="index.html#type-port">port</a> <span>&#45;&gt;</span> <a href="index.html#type-data">data</a></code></dt><dd><p><code>get conn p</code> returns the data read on port <code>p</code>. Before using this function, you must set the sensor type with <a href="index.html#val-set"><code>Mindstorm.NXT.Sensor.set</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-color_of_data"><a href="#val-color_of_data" class="anchor"></a><code><span class="keyword">val</span> color_of_data : <a href="index.html#type-data">data</a> <span>&#45;&gt;</span> [ `Black | `Blue | `Green | `Yellow | `Red | `White ]</code></dt><dd><p>Returns the color seen by the color sensor from its reading. This is usually only accurate at a distance of about 1cm.</p><dl><dt>raises Invalid_argument</dt><dd><p>if not applied to a <code>`Color_full</code> sensor.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-reset_scaled"><a href="#val-reset_scaled" class="anchor"></a><code><span class="keyword">val</span> reset_scaled : ?&#8288;check_status:bool <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../index.html#type-conn">conn</a> <span>&#45;&gt;</span> <a href="index.html#type-port">port</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>reset_scaled conn port</code></p><dl><dt>parameter check_status</dt><dd><p>whether to check the status returned by the brick. Default: see <a href="../index.html#val-connect_bluetooth"><code>Mindstorm.NXT.connect_bluetooth</code></a>.</p></dd></dl></dd></dl><section><header><h5 id="low-speed"><a href="#low-speed" class="anchor"></a>Low speed</h5></header><aside><p>Commands dealing with the I2C bus available on every digital sensor. (The port number 4 may also be high speed.)</p></aside><dl><dt class="spec value" id="val-get_status"><a href="#val-get_status" class="anchor"></a><code><span class="keyword">val</span> get_status : <span class="type-var">'a</span> <a href="../index.html#type-conn">conn</a> <span>&#45;&gt;</span> <a href="index.html#type-port">port</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>get_status conn port</code> returns the number of bytes ready to be read.</p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : ?&#8288;check_status:bool <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../index.html#type-conn">conn</a> <span>&#45;&gt;</span> <a href="index.html#type-port">port</a> <span>&#45;&gt;</span> ?&#8288;rx_length:int <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>write conn port yx_data</code> writes <code>tx_data</code> to lowspeed I2C sensor connected to the <code>port</code>. This is the protocol (e.g. for talking to the ultrasonic sensor). Communication errors will be reported by raising <code>Error Bus_error</code>; your application should be ready to handle such exceptions.</p><dl><dt>parameter rx_length</dt><dd><p>gives the number of bytes to receive. Default: <code>0</code> i.e. no answer expected.</p></dd></dl><dl><dt>parameter check_status</dt><dd><p>whether to check the status returned by the brick. Default: see <a href="../index.html#val-connect_bluetooth"><code>Mindstorm.NXT.connect_bluetooth</code></a>.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <span class="type-var">'a</span> <a href="../index.html#type-conn">conn</a> <span>&#45;&gt;</span> <a href="index.html#type-port">port</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Read data from from lowspeed I2C port (e.g. for receiving data from the ultrasonic sensor). Communication errors will be reported by raising <code>Error Bus_error</code>; your application should be ready to handle such exceptions.</p></dd></dl></section><section><header><h5 id="convenience"><a href="#convenience" class="anchor"></a>Convenience</h5></header><dl><dt class="spec module" id="module-Ultrasonic"><a href="#module-Ultrasonic" class="anchor"></a><code><span class="keyword">module</span> <a href="Ultrasonic/index.html">Ultrasonic</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Ultrasonic sensor. Convenience functions to interact with the ultrasonic sensor through the I2C protocol.</p></dd></dl></section></div></body></html>