<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mindstorm (mindstorm.Mindstorm)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">mindstorm</a> &#x00BB; Mindstorm</nav><h1>Module <code>Mindstorm</code></h1><p>Drive Lego Minsdstorm bricks with OCaml.</p><nav class="toc"><ul><li><a href="#nxt-and-ev3-bricks">NXT and EV3 bricks</a></li><li><a href="#connectBluetooth">How to connect the brick through bluetooth</a><ul><li><a href="#linux">Linux</a></li><li><a href="#macos-x">MacOS X</a></li><li><a href="#windows">Windows</a><ul><li><a href="#without-the-fantom-drivers-installed">Without the fantom drivers installed</a></li><li><a href="#with-the-fantom-drivers-installed">With the fantom drivers installed</a></li></ul></li></ul></li><li><a href="#connectUSB">How to connect the brick through USB</a><ul><li><a href="#linux">Linux</a></li><li><a href="#macos-x">MacOS X</a></li><li><a href="#windows">Windows</a></li></ul></li></ul></nav></header><aside><p>Mindstorm is a library that enables you to drive Lego mindstorm NXT or EV3 bricks from OCaml (the computer is the master and the brick is the slave). Communication with the brick is done through Bluetooth and USB.</p><dl><dt>author</dt><dd>Christophe Troestler &lt;Christophe.Troestler@umons.ac.be&gt;</dd></dl></aside><section><header><h3 id="nxt-and-ev3-bricks"><a href="#nxt-and-ev3-bricks" class="anchor"></a>NXT and EV3 bricks</h3></header><dl><dt class="spec module" id="module-NXT"><a href="#module-NXT" class="anchor"></a><code><span class="keyword">module</span> <a href="NXT/index.html">NXT</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Mindstorm.NXT</code> — Interface to NXT bricks.</p></dd></dl><dl><dt class="spec module" id="module-EV3"><a href="#module-EV3" class="anchor"></a><code><span class="keyword">module</span> <a href="EV3/index.html">EV3</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>(ALPHA VERSION) <code>Mindstorm.EV3</code> — Interface to EV3 bricks.</p></dd></dl></section><section><header><h3 id="connectBluetooth"><a href="#connectBluetooth" class="anchor"></a>How to connect the brick through bluetooth</h3><p>You need to create a serial port connection using the instructions below for your platform. Then use <a href="NXT/index.html#val-connect_bluetooth"><code>NXT.connect_bluetooth</code></a> to create a handle for the brick.</p></header><section><header><h4 id="linux"><a href="#linux" class="anchor"></a>Linux</h4><p>First make sure your kernel has bluetooth support (this is likely) and that the bluez and gnome-bluetooth (or kdebluetooth) pakages are installed. You should see a bluetooth applet icon. Then do (the text after the $ sign is what you type, underneath is the answer):</p><pre>        $ hcitool scan
        Scanning ...
                00:16:53:03:A5:32     NXT</pre><p>to discover the address of your brick. Then use <a href="NXT/index.html#val-connect_bluetooth"><code>NXT.connect_bluetooth</code></a><code> &quot;00:16:53:03:A5:32&quot;</code> or <a href="EV3/index.html#val-connect_bluetooth"><code>EV3.connect_bluetooth</code></a><code> &quot;00:16:53:03:A5:32&quot;</code> to establish the connection (of course, replace <code>&quot;00:16:53:03:A5:32&quot;</code> by your actual bluetooth address) — the first time, the brick will ask you to enter a code and the bluetooth applet will pop up a box in which you need to copy the very same code (this is to forbid unwanted connections).</p><p>If test programs fail with <code>Unix.Unix_error(Unix.EUNKNOWNERR ...)</code> and your computer does not ask you the passkey (which may indicate that you should check that the blueman applet is not running multiple times), pair the brick with your computer first. One way to do it is to run <code>bluetoothctl</code> and type at its prompt (output only partly shown):</p><pre>        [bluetooth]# scan on
        Discovery started
        [CHG] Controller 87:EE:A8:C3:A5:83 Discovering: yes
        [NEW] Device 01:15:34:56:31:11 EV3
        [bluetooth]# agent on
        Agent registered
        [bluetooth]# default-agent
        Default agent request successful
        [bluetooth]# pair 01:15:34:56:31:11
        Attempting to pair with 01:15:34:56:31:11
        Request PIN code
        [agent] Enter PIN code: 1234
        ...</pre><p>You should then be able to connect to the brick without a confirmation being requested.</p></header></section><section><header><h4 id="macos-x"><a href="#macos-x" class="anchor"></a>MacOS X</h4><ol><li>Turn on the NXT brick and make sure bluetooth is on and visible (you should see a bluetooth icon at the top left corner).</li><li>Turn on the Bluetooth on your Mac. Then click the bluetooth icon in the menubar, select &quot;Open Bluetooth Preferences...&quot;</li><li>You should see the brick (it's just called <code>NXT</code> by default) listed under 'Devices', with an option called 'Pair' on the right. If you don't see the device or don't see 'Pair', consider restarting the bluetooth on your computer and your brick and double-checking visibility.</li><li>Select the <code>Pair</code> option beside <code>NXT</code> from the list.;</li><li>The NXT will beep and ask for a passkey. Choose 1234 (this is the default but you can choose anything you like) and press the orange button.</li><li>The Mac will immediately complain, saying &quot;Pairing failed&quot;. Ignore this. You will see that a new button, called &quot;Options&quot;, has become available in the bluetooth menu. Click it. You'll now see a prompt for a code. Enter the same passkey as you did on the brick itself.</li><li>The NXT will beep again. You must enter your code yet again. This three-step process should get you your connection. On the Bluetooth menu, you will find that NXT is 'Connected'.</li><li>Note: It is pointless to proceed unless the steps above have been completed. Even if you run into trouble, please work on getting through the above before proceeding.</li><li>Now the brick and the Mac are talking, but we need to know which egress port is being used by the Mac, so we can send out our instructions to the brick via that port. Fortunately, this is easy enough to do. Run <code>ls -t /dev</code> in Terminal. This lists the files in the directory <code>/dev</code> arranged by the last time they were modified, with the most recent on top.</li><li>Somewhere near the top, you will see an entry alike <code>tty.NXT-DevB</code>. Figure out exactly what it is for your computer. This name is very important.</li></ol><p>You're done! You should now have a <code>/dev/tty.NXT-DevB</code>. This means you can connect to the brick using something to the tone of <a href="NXT/index.html#val-connect_bluetooth"><code>NXT.connect_bluetooth</code></a><code> &quot;/dev/tty.NXT-DevB&quot;</code>. Substitute with the name you found above, of course. Beware that if you rename the brick with <a href="NXT/index.html#val-set_brick_name"><code>NXT.set_brick_name</code></a>, you will have to change the name accordingly. Note also that this name may change when you disconnect and reconnect. If you can't establish a connection some time in the future, consider going back and checking the <code>/dev</code> directory to see if things have changed.</p></header></section><section><header><h4 id="windows"><a href="#windows" class="anchor"></a>Windows</h4></header><section><header><h5 id="without-the-fantom-drivers-installed"><a href="#without-the-fantom-drivers-installed" class="anchor"></a>Without the fantom drivers installed</h5><p>From windows, open the bluetooth control panel, create a new connection to the NXT brick, right click on your connection and select &quot;details&quot; to see which serial port is used, for example COM40. Then use <a href="NXT/index.html#val-connect_bluetooth"><code>NXT.connect_bluetooth</code></a><code> &quot;COM40&quot;</code> to connect to the brick from your programs. ATM, you have to always start by establishing the connection by hand before you can use the brick. Patches are welcome so that is is enough to pass the bluetooth address to <a href="NXT/index.html#val-connect_bluetooth"><code>NXT.connect_bluetooth</code></a> and the library performs the connection.</p><p>Windows Vista uses different ports for outgoing and incoming connections (e.g. COM4 for outgoing connections and COM5 for incoming ones). With this library, you must use the outgoing port.</p></header></section><section><header><h5 id="with-the-fantom-drivers-installed"><a href="#with-the-fantom-drivers-installed" class="anchor"></a>With the fantom drivers installed</h5><p>Once the fantom drivers are on your machine (which is the case if you installed the LEGO® NXTG software), the above method does not work anymore. It is then probably necessary to use these drivers through the <a href="http://mindstorms.lego.com/Overview/NXTreme.aspx">Driver SDK</a>. This will be investigated in a subsequent revision of this library but you are encouraged to contribute.</p></header></section></section></section><section><header><h3 id="connectUSB"><a href="#connectUSB" class="anchor"></a>How to connect the brick through USB</h3></header><section><header><h4 id="linux"><a href="#linux" class="anchor"></a>Linux</h4><p>For easy access, create a <code>lego</code> group, add your user to it, and create a file <code>/etc/udev/rules.d/70-lego.rules</code> containing:</p><pre>        # Lego NXT                                               -*-conf-*-
        BUS==&quot;usb&quot;, SYSFS{idVendor}==&quot;0694&quot;, GROUP=&quot;lego&quot;, MODE=&quot;0660&quot;</pre><p>To list the NXT bricks connected through USB to your computer, use <a href="NXT/USB/index.html#val-bricks"><code>NXT.USB.bricks</code></a>. To connect to one of these bricks, say <code>b</code>, use <a href="NXT/USB/index.html#val-connect"><code>NXT.USB.connect</code></a><code> b</code> (you can the query the brick, say for its name, to decide whether it is the device you want to talk to).</p></header></section><section><header><h4 id="macos-x"><a href="#macos-x" class="anchor"></a>MacOS X</h4><p>TBD.</p></header></section><section><header><h4 id="windows"><a href="#windows" class="anchor"></a>Windows</h4><p>Install <a href="http://libusb-win32.sourceforge.net/">libusb-win32</a>.</p><p>You need the LEGO® Mindstorms NXT software installed, as its USB drivers are used. (Please contribute.)</p></header></section></section></div></body></html>